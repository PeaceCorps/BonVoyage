extends layout

block styles
	link(rel='stylesheet', href='/css/approval.css')
block content
	.row
		.col-xs-12.col-md-offset-1.col-md-10

			.jumbotron
				h2 Request Overview

				include flash
				
				#request
					- var did_match_user = (request.user && request.user.length > 0);
					if did_match_user
						h2 Contact 
						.shadow-box
							p
								span 
									b Name: 
								span= request.user[0].name
							p
								span 
									b Email: 
								span= (request.user[0].email ? request.user[0].email : "No email on file.")
							p
								span 
									b Phone: 
								span= (request.user[0].phone ? request.user[0].phone : "No phone on file.")
					h2 Trip Itinerary
					.shadow-box
						each leg in request.legs
							p
								span.date(data-unformatted="#{leg.start_date}")
								span  - 
								span.date(data-unformatted="#{leg.end_date}")
								span : #{leg.country}
							p
								span
									b Hotel/Hostel info: 
								span= (leg.hotel ? leg.hotel : "No description on file.")
							p
								span
									b Travel contact: 
								span= (leg.contact ? leg.contact : "No description on file.")
							p
								span
									b Companions: 
								span= (leg.companions ? leg.companions : "No description on file.")
							p 
								span
									b Description: 
								span= (leg.description ? leg.description : "No description on file.")
							each warning in leg.warnings
								.warning.alert.alert-danger(role='alert')
									span.glyphicon.glyphicon-exclamation-sign(aria-hidden='true')
									span
										b #{warning.type}: 
									span= warning.text_overview + " "
									span
										b
											a(href=warning.link) More Information
					h2 Comments #{(request.comments.length > 0 ? "(" + request.comments.length + ")" : "")}
					.shadow-box
						table#comments
							each comment in request.comments
								.comment
									p
										span 
											b Name: 
										span= comment.name
									p
										span 
											b Time: 
										span.timestamp(data-unformatted="#{comment.timestamp}")
									p
										span
											b Comment: 
										span= comment.content
						
						textarea.form-control#new-comment(rows=3, onkeyup="commentStoppedTyping()", name="content")
						button.btn.btn-default.disabled#submit-comment Submit Comment

				// If supervisor or higher
				if user.access > 0 
					#request_approval.row
						.col-xs-6
							button(class="btn btn-success" + (request.is_pending == false && request.is_approved ? " disabled" : ""), id="request-approve-btn") Approve
						.col-xs-6
							button(class="btn btn-danger" + (request.is_pending == false && !request.is_approved ? " disabled" : ""), id="request-deny-btn") Deny
				// If the user is the owner of the request
				if did_match_user && (user.email == request.user[0].email)
					#request_delete.row
						.col-xs-12
							button(class="btn btn-danger", id="request-delete-btn") Delete Request
				#request_pagination.row
					.col-xs-6
						a(href=(prev_request_id ? "/requests/#{prev_request_id}" : "")) 
							button(class="btn btn-default" + (prev_request_id ? "" : " disabled")) < Prev
					.col-xs-6
						a(href=(next_request_id ? "/requests/#{next_request_id}" : "")) 
							button(class="btn btn-default" + (next_request_id ? "" : " disabled")) Next >

block scripts
	script(src='/js/moment.js')
	script(src='/js/approval.js')
